{{- /* Sets up Sidecar resource to reduce proxy configuration size */ -}}
{{- if and .Values.package.istio.reduceConfigSize.enabled .Values.bigbang.istio.enabled -}}
apiVersion: networking.istio.io/v1
kind: Sidecar
metadata:
  name: {{ include "resourceName" (printf "%s-sidecar" .Values.package.name) }}
  labels:
    {{- include "commonLabels" $ | nindent 4 }}
spec:
  egress:
    - hosts:
      - "./*"
      - "istio-system/*"
      {{- range .Values.package.istio.reduceConfigSize.allowServices }}
      - {{ . | printf "%s/*" | quote }}
      {{- end }}
---
{{- end -}}
